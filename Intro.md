# Introduction

Верифицировать иногда надо. Тулчейны-то уж точно стоит, потому что баги в
них, как правило, труднонаходимы, но могут причинить много боли.

Люди пытаются делать что-то на тему верификации тулчейнов, но пока
получается как-то не очень. Есть, к примеру, VeLLVM, который формализует
язык LLVM и делает доказанно корректные оптимизации в нем. Еще есть
CompCert, который представляет собой компилятор, делающий внутри себя
оптимизации, доказанно сохраняющие семантику программы. Но линкер он
использует системный, не верифицированный.

Может показаться, что линкер — достаточно тупая программа, в которой трудно
ошибиться. Но, тем не менее, в какой-то момент стали делать оптимизации на
этапе линковки, которые усложняют логику линкера, и в итоге в ней
действительно становится возможным ошибиться в коде линкера. Какие-то
чуваки в 2015 делали стресс-тесты для линкеров, и находили просто уйму
багов на этапе оптимизаций во время линковки. Это показывает, что
верифицировать линкеры все-таки нужно.

Линкер — достаточно низкоуровневая программа, которая работает с
скомпилированными объектными файлами, а значит, для рассуждений про него
надо искать формализации чего-то, очень близкого к ассемблеру. В этой
области есть Bedrock, который можно назвать чем-то типа макро-языка для
ассемблера, формализованного на Coq. Они пытались что-то делать с
линковкой, но получилось не очень.

Существует хорошая формализация ассемблера — TAL от Моррисетта и компании,
и много его расширений, покрывающих, например, почти настоящий язык
ассемблера x86 (TALx86), работу со стеком (STAL) и даже объектные файлы
(MTAL). Кстати говоря, в той же работе, что описывает MTAL, пытались что-то
делать с линковкой объектных файлов, но осилили только статическую.
Формализовать динамическую линковку — вот реальный челлендж.

TAL, конечно, всем хорош, но, к сожалению, TAL-релейтед утилиты написаны на
ML, а все доказательства про TAL делаются по-старинке, на бумажке. В этой
статье используется формализация на агде, близкая к смеси TALx86, STAL и
MTAL. На этом всем определяется, какие элементы добавляются в программу в
процессе динамической линковки, вводится понятие эквивалентности различных
программ и доказывается, что при правильно работающей рантайм-части линкера
статически и динамически слинкованные программы получатся эквивалентными.

Это можно считать первыми шагами в области формализации динамической
линковки, из чего впоследствии можно получить верифицированный линкер,
использующий под собой какую-то работающую математическую модель.
